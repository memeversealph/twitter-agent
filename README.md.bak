# agent-twitter-client

è¿™æ˜¯[@the-convocation/twitter-scraper](https://github.com/the-convocation/twitter-scraper)çš„ä¿®æ”¹ç‰ˆæœ¬ï¼Œå¢åŠ äº†å‘é€æ¨æ–‡å’Œè½¬æ¨çš„åŠŸèƒ½ã€‚è¿™ä¸ªåŒ…ä¸éœ€è¦Twitter APIå³å¯ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç¯å¢ƒä¸­è¿è¡Œã€‚

## å®‰è£…

```sh
npm install agent-twitter-client
```

## è®¾ç½®

é…ç½®ç”¨äºèº«ä»½éªŒè¯çš„ç¯å¢ƒå˜é‡ã€‚

```
TWITTER_USERNAME=    # è´¦å·ç”¨æˆ·å
TWITTER_PASSWORD=    # è´¦å·å¯†ç 
TWITTER_EMAIL=       # è´¦å·é‚®ç®±
PROXY_URL=           # è¯·æ±‚çš„HTTP(S)ä»£ç†ï¼ˆæµè§ˆå™¨ç¯å¢ƒå¿…éœ€ï¼‰

# Twitter API v2 å‡­æ®ï¼ˆç”¨äºæ¨æ–‡å’ŒæŠ•ç¥¨åŠŸèƒ½ï¼‰
TWITTER_API_KEY=               # Twitter API å¯†é’¥
TWITTER_API_SECRET_KEY=        # Twitter API å¯†é’¥
TWITTER_ACCESS_TOKEN=          # Twitter API v2 è®¿é—®ä»¤ç‰Œ
TWITTER_ACCESS_TOKEN_SECRET=   # Twitter API v2 è®¿é—®ä»¤ç‰Œå¯†é’¥
```

### è·å–Twitter Cookies

ä½¿ç”¨Twitter cookieså¯ä»¥é¿å…æ¯æ¬¡æ‰§è¡Œæ“ä½œæ—¶éƒ½å‘Twitterå‘é€æ–°çš„ç™»å½•è¯·æ±‚ã€‚

åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ£€æŸ¥ç°æœ‰çš„cookiesã€‚å¦‚æœæ²¡æœ‰å¯ç”¨çš„cookiesï¼Œä½¿ç”¨ç”¨æˆ·èº«ä»½éªŒè¯å‡­æ®ç™»å½•ï¼Œå¹¶ç¼“å­˜cookiesä»¥ä¾›å°†æ¥ä½¿ç”¨ã€‚

```ts
const scraper = await getScraper({ authMethod: 'password' });

scraper.getCookies().then((cookies) => {
  console.log(cookies);
  // ç§»é™¤ 'Cookies' å¹¶å°†cookiesä¿å­˜ä¸ºJSONæ•°ç»„
});
```

## å¿«é€Ÿå¼€å§‹

```ts
const scraper = new Scraper();
await scraper.login('ç”¨æˆ·å', 'å¯†ç ');

// å¦‚æœä½¿ç”¨v2åŠŸèƒ½ï¼ˆç›®å‰éœ€è¦æ”¯æŒæŠ•ç¥¨ï¼‰
await scraper.login(
  'ç”¨æˆ·å',
  'å¯†ç ',
  'é‚®ç®±',
  'åº”ç”¨ç¨‹åºå¯†é’¥',
  'åº”ç”¨ç¨‹åºå¯†é’¥',
  'è®¿é—®ä»¤ç‰Œ',
  'è®¿é—®ä»¤ç‰Œå¯†é’¥',
);

const tweets = await scraper.getTweets('elonmusk', 10);
const tweetsAndReplies = scraper.getTweetsAndReplies('elonmusk');
const latestTweet = await scraper.getLatestTweet('elonmusk');
const tweet = await scraper.getTweet('1234567890123456789');
await scraper.sendTweet('Hello world!');

// åˆ›å»ºä¸€ä¸ªæŠ•ç¥¨
await scraper.sendTweetV2(
  'What's got you most hyped? Let us know! ğŸ¤–ğŸ’¸',
  undefined,
  {
    poll: {
      options: [
        { label: 'AI Innovations ğŸ¤–' },
        { label: 'Crypto Craze ğŸ’¸' },
        { label: 'Both! ğŸŒŒ' },
        { label: 'Neither for Me ğŸ˜…' },
      ],
      durationMinutes: 120, // æŠ•ç¥¨æŒç»­æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
    },
  },
);
```

### è·å–ç‰¹å®šæ¨æ–‡æ•°æ®ï¼ˆV2ï¼‰

```ts
// è·å–ä¸€ä¸ªå¸¦æœ‰æŠ•ç¥¨è¯¦ç»†ä¿¡æ¯çš„æ¨æ–‡
const tweet = await scraper.getTweetV2('1856441982811529619', {
  expansions: ['attachments.poll_ids'],
  pollFields: ['options', 'end_datetime'],
});
console.log('tweet', tweet);

// è·å–å¤šä¸ªå¸¦æœ‰æŠ•ç¥¨å’Œåª’ä½“è¯¦ç»†ä¿¡æ¯çš„æ¨æ–‡
const tweets = await scraper.getTweetsV2(
  ['1856441982811529619', '1856429655215260130'],
  {
    expansions: ['attachments.poll_ids', 'attachments.media_keys'],
    pollFields: ['options', 'end_datetime'],
    mediaFields: ['url', 'preview_image_url'],
  },
);
console.log('tweets', tweets);
```

## API

### èº«ä»½éªŒè¯

```ts
// ç™»å½•
await scraper.login('ç”¨æˆ·å', 'å¯†ç ');

// ç™»å‡º
await scraper.logout();

// æ£€æŸ¥æ˜¯å¦ç™»å½•
const isLoggedIn = await scraper.isLoggedIn();

// è·å–å½“å‰ä¼šè¯çš„cookies
const cookies = await scraper.getCookies();

// è®¾ç½®å½“å‰ä¼šè¯çš„cookies
await scraper.setCookies(cookies);

// æ¸…é™¤å½“å‰çš„cookies
await scraper.clearCookies();
```

### ä¸ªäººèµ„æ–™

```ts
// è·å–ç”¨æˆ·çš„ä¸ªäººèµ„æ–™
const profile = await scraper.getProfile('TwitterDev');

// è·å–ç”¨æˆ·IDé€šè¿‡ç”¨æˆ·å
const userId = await scraper.getUserIdByScreenName('TwitterDev');

// è·å–ç™»å½•ç”¨æˆ·çš„ä¸ªäººèµ„æ–™
const me = await scraper.me();
```

### æœç´¢

```ts
import { SearchMode } from 'agent-twitter-client';

// æœç´¢æœ€è¿‘çš„æ¨æ–‡
const tweets = scraper.searchTweets('#nodejs', 20, SearchMode.Latest);

// æœç´¢ä¸ªäººèµ„æ–™
const profiles = scraper.searchProfiles('John', 10);

// è·å–æ¨æ–‡æœç´¢ç»“æœçš„ä¸€é¡µ
const results = await scraper.fetchSearchTweets('#nodejs', 20, SearchMode.Top);

// è·å–ä¸ªäººèµ„æ–™æœç´¢ç»“æœçš„ä¸€é¡µ
const profileResults = await scraper.fetchSearchProfiles('John', 10);
```

### å…³ç³»

```ts
// è·å–ç”¨æˆ·çš„å…³æ³¨è€…
const followers = scraper.getFollowers('12345', 100);

// è·å–ç”¨æˆ·å…³æ³¨çš„äºº
const following = scraper.getFollowing('12345', 100);

// è·å–ç”¨æˆ·å…³æ³¨è€…çš„ä¸€é¡µ
const followerResults = await scraper.fetchProfileFollowers('12345', 100);

// è·å–ç”¨æˆ·å…³æ³¨çš„äººçš„ä¸€é¡µ
const followingResults = await scraper.fetchProfileFollowing('12345', 100);

// å…³æ³¨ä¸€ä¸ªç”¨æˆ·
const followUserResults = await scraper.followUser('elonmusk');
```

### è¶‹åŠ¿

```ts
// è·å–å½“å‰çš„è¶‹åŠ¿
const trends = await scraper.getTrends();

// è·å–åˆ—è¡¨ä¸­çš„æ¨æ–‡
const listTweets = await scraper.fetchListTweets('1234567890', 50);
```

### æ¨æ–‡

```ts
// è·å–ç”¨æˆ·çš„æ¨æ–‡
const tweets = scraper.getTweets('TwitterDev');

// è·å–ç”¨æˆ·çš„ç‚¹èµæ¨æ–‡
const likedTweets = scraper.getLikedTweets('TwitterDev');

// è·å–ç”¨æˆ·çš„æ¨æ–‡å’Œå›å¤
const tweetsAndReplies = scraper.getTweetsAndReplies('TwitterDev');

// è·å–åŒ¹é…ç‰¹å®šæ¡ä»¶çš„æ¨æ–‡
const timeline = scraper.getTweets('TwitterDev', 100);
const retweets = await scraper.getTweetsWhere(
  timeline,
  (tweet) => tweet.isRetweet,
);

// è·å–ç”¨æˆ·çš„æœ€æ–°æ¨æ–‡
const latestTweet = await scraper.getLatestTweet('TwitterDev');

// è·å–ä¸€ä¸ªç‰¹å®šçš„æ¨æ–‡é€šè¿‡ID
const tweet = await scraper.getTweet('1234567890123456789');

// å‘é€ä¸€ä¸ªæ¨æ–‡
const sendTweetResults = await scraper.sendTweet('Hello world!');

// å‘é€ä¸€ä¸ªå¸¦æœ‰åª’ä½“çš„æ¨æ–‡
const sendQuoteTweetResults = await scraper.sendQuoteTweet('Hello world!', '1234567890123456789', ['mediaFile1', 'mediaFile2']);

// è½¬å‘ä¸€ä¸ªæ¨æ–‡
const retweetResults = await scraper.retweet('1234567890123456789');

// ç‚¹èµä¸€ä¸ªæ¨æ–‡
const likeTweetResults = await scraper.likeTweet('1234567890123456789');
```

## å‘é€å¸¦æœ‰åª’ä½“çš„æ¨æ–‡

### åª’ä½“å¤„ç†
Scraperéœ€è¦å°†åª’ä½“æ–‡ä»¶å¤„ç†æˆç‰¹å®šçš„æ ¼å¼æ‰èƒ½å‘é€ï¼š
- åª’ä½“æ–‡ä»¶éœ€è¦è½¬æ¢æˆBufferæ ¼å¼
- æ¯ä¸ªåª’ä½“æ–‡ä»¶éœ€è¦æŒ‡å®šMIMEç±»å‹
- è¿™æ ·å¯ä»¥å¸®åŠ©ScraperåŒºåˆ†å›¾åƒå’Œè§†é¢‘å¤„ç†æ¨¡å‹

### åŸºæœ¬æ¨æ–‡å¸¦æœ‰åª’ä½“
```ts
// ç¤ºä¾‹ï¼šå‘é€ä¸€ä¸ªå¸¦æœ‰åª’ä½“é™„ä»¶çš„æ¨æ–‡
const mediaData = [
  {
    data: fs.readFileSync('path/to/image.jpg'),
    mediaType: 'image/jpeg'
  },
  {
    data: fs.readFileSync('path/to/video.mp4'),
    mediaType: 'video/mp4'
  }
];

await scraper.sendTweet('Hello world!', undefined, mediaData);
```

### æ”¯æŒçš„åª’ä½“ç±»å‹
```ts
// å›¾åƒæ ¼å¼å’ŒMIMEç±»å‹
const imageTypes = {
  '.jpg':  'image/jpeg',
  '.jpeg': 'image/jpeg',
  '.png':  'image/png',
  '.gif':  'image/gif'
};

// è§†é¢‘æ ¼å¼
const videoTypes = {
  '.mp4': 'video/mp4'
};
```

### åª’ä½“ä¸Šä¼ é™åˆ¶
- æ¯ä¸ªæ¨æ–‡æœ€å¤š4å¼ å›¾åƒ
- æ¯ä¸ªæ¨æ–‡æœ€å¤š1ä¸ªè§†é¢‘
- è§†é¢‘æ–‡ä»¶å¤§å°é™åˆ¶ï¼š512MB
- æ”¯æŒçš„å›¾åƒæ ¼å¼ï¼šJPGã€PNGã€GIF
- æ”¯æŒçš„è§†é¢‘æ ¼å¼ï¼šMP4
